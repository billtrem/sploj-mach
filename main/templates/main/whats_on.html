{% extends 'main/base.html' %}
{% load static %}

{% block title %}What’s On / Beth Sy'n Mlaen – Sploj{% endblock %}

{% block content %}
<div class="whats-on-container">
    <div class="poster-grid">
        {% for project in projects %}
            <div class="poster-tile" onclick="openProjectModal('{{ project.slug }}')">
                {% if project.poster %}
                    <img src="{{ project.poster.url }}" alt="{{ project.title }}" class="poster-image" />
                {% else %}
                    <div class="poster-placeholder">{{ project.title }}</div>
                {% endif %}
            </div>
        {% empty %}
            <p class="no-films-message">
                No projects yet / Dim prosiectau eto. 
                Check back soon / Dewch yn ôl yn fuan!
            </p>
        {% endfor %}
    </div>
</div>

<!-- ✅ Modal -->
<div id="projectModal" class="film-modal" style="display:none;">
    <div class="modal-content">
        <button class="close-button" type="button" aria-label="Close modal / Cau modalen" onclick="closeProjectModal()">
            &times;
        </button>
        <div id="modal-project-detail-content"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function openProjectModal(slug) {
    console.log("Opening modal for slug:", slug);
    fetch(`/project-modal/${slug}/`)
        .then(response => {
            console.log("Fetch response status:", response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.text();
        })
        .then(html => {
            document.getElementById('modal-project-detail-content').innerHTML = html;
            document.getElementById('projectModal').style.display = 'block';
            console.log("Modal content loaded successfully");
        })
        .catch(err => {
            console.error('❌ Error loading project modal / Gwall wrth lwytho modalen prosiect:', err);
        });
}

function closeProjectModal() {
    console.log("Closing modal");
    document.getElementById('projectModal').style.display = 'none';
    document.getElementById('modal-project-detail-content').innerHTML = '';
}

window.addEventListener('click', function(event) {
    const modal = document.getElementById('projectModal');
    if (event.target === modal) {
        closeProjectModal();
    }
});
</script>
{% endblock %}
